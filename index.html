<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Angular Azure Blob</title>
  </head>

  <body ng-app="azureBlobStorage">
    <div ng-controller="DemoController" class="container">
      <form>
        <input type="file" file-selected="selectFile($files)" />
        <strong>Progress: {{ progress }}.</strong>
      </form>
    </div>

    <script type="text/javascript" src="libs/angular/angular.min.js"></script>
    <script type="text/javascript" src="dist/angular-azure-blob.js"></script>
    <script type="text/javascript" src="libs/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="libs/base-64/base64.js"></script>
    <script type="text/javascript" src="libs/atomic/dist/atomic.min.js"></script>
    
    <script type="text/javascript" src="libs/crypto-js/crypto-js.js"></script>
    <script type="text/javascript" src="libs/crypto-js/md5.js"></script>
    <script type="text/javascript" src="libs/crypto-js/lib-typedarrays.js"></script>
    <script type="text/javascript" src="libs/crypto-js/enc-base64.js"></script>

    <!-- <script type="text/javascript" src="libs/angular/angular.min.js"></script>
    <script type="text/javascript" src="dist/angular-azure-blob.js"></script> -->

    <script type="text/javascript">
      angular.module('azureBlobStorage').controller('DemoController', [
        '$scope', 'azureBlobUpload', function ($scope, azureBlobUpload) {
          $scope.progress = 0;

          $scope.selectFile = function (files) {
            azureBlobUpload.upload({
                workerFileName: 'azure-blob-upload-worker.js',
                path: '/dist/',
                libPath: '/libs/',
                getBlobUri: function (file) {
                  return {
                    then: function(cb) {
                      cb('xxx');
                    }
                  };
                },
                files: files.map(function(f) {
                  return { fileName: f.name, file: f };
                }),
                progress: function cb(item, payload) {
                  $scope.$apply(function () {
                    $scope.progress = payload.percentComplete;
                  });
                },
                complete: function cb() {},
                error: function cb() {},
                blockSize: 1024 * 1024, // optional
                calculateFileMd5: false // optional, false by default
            });
          };
        }]);
    </script>
  </body>
</html>
